# x402 Protocol Integration

The x402 protocol enables autonomous AI agents to interact with ZeroPay for programmatic payments. This document describes the x402 implementation in ZeroPay and how to integrate it with AI agents.

## Table of Contents

- [Overview](#overview)
- [How It Works](#how-it-works)
- [Key Benefits](#key-benefits)
- [Supported Payment Schemes](#supported-payment-schemes)
- [API Endpoints](#api-endpoints)
- [Client SDKs](#client-sdks)
- [Additional Resources](#additional-resources)

## Overview

The x402 Agent-to-Agent (A2A) payment protocol enables AI agents and autonomous systems to programmatically discover, authorize, and settle payments using EIP-3009 gasless transfers.

## How It Works

1. **Requirements**: query `/x402/requirements` to get payment requirements
2. **Authorization**: Agent creates an EIP-712 signature authorizing the payment
3. **Settlement**: ZeroPay verifies the signature and settles via `transferWithAuthorization`
4. **Response**: Agent receives transaction hash and settlement confirmation

## Key Benefits

- **Gasless Payments**: Payee covers gas fees, not the payer
- **Instant Settlement**: No waiting for blockchain confirmations
- **Secure**: EIP-712 signatures with time-bound authorization
- **Discoverable**: Agents can browse available services via `/x402/discovery`

## Supported Payment Schemes

- **exact**: EIP-3009 exact transfer authorization
- **Networks**: Base, Ethereum, Polygon, and other EVM chains
- **Tokens**: USDC and other EIP-3009 compatible tokens

## API Endpoints

ZeroPay implements the following x402 API endpoints:

### Query Payment Requirements

Get payment requirements for a resource:

```bash
curl -X POST "http://localhost:9000/x402/requirements?apikey=your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "customer": "agent_alice",
    "amount": 1000
  }'
```

### Submit Payment Authorization

Submit payment authorization and settle:

```bash
curl -X POST "http://localhost:9000/x402/payments?apikey=your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "payment_payload": {
      "x402_version": 1,
      "scheme": "exact",
      "network": "base-sepolia",
      "payload": {
        "signature": "0x...",
        "authorization": {
          "from": "0x...",
          "to": "0x...",
          "value": "1000000",
          "validAfter": "0",
          "validBefore": "1735689600",
          "nonce": "0x..."
        }
      }
    },
    "payment_requirements": {...}
  }'
```

### List Supported Payment Methods

Get list of supported payment schemes and networks:

```bash
curl "http://localhost:9000/x402/support?apikey=your-api-key"
```

### Discover Available Services

Browse available payment-enabled resources:

```bash
curl "http://localhost:9000/x402/discovery?apikey=your-api-key"
```

## Client SDKs

For AI agent developers, use the ZeroPay x402 client SDK:

```rust
use x402::client::{ClientFacilitator, PaymentMethod};

// Initialize client with wallet
let facilitator = ClientFacilitator::new();
facilitator.add_payment_method(
    "base-sepolia",
    PaymentMethod::Evm(signer, rpc_url, tokens)
);

// Create payment payload
let payload = facilitator.create_payment(&requirements).await?;

// Submit payment
let response = facilitator.pay(&url, payload).await?;
```

## Additional Resources

- **[AI Integration Guide](./docs/AI_INTEGRATION_GUIDE.md)** - Prompt and guide for AI agents to integrate with ZeroPay API
- **[x402 Specification](https://github.com/zeropaydev/x402)** - Official x402 protocol specification
- **[API Documentation](./docs/API_DOCUMENTATION.md)** - Detailed API reference

## Support

For x402-specific questions and issues:
- **x402 Protocol Spec**: [https://github.com/zeropaydev/x402](https://github.com/zeropaydev/x402)
- **GitHub Issues**: [https://github.com/ZeroPayDev/zeropay/issues](https://github.com/ZeroPayDev/zeropay/issues)
- **Platform Support**: hi@zpaynow.com
